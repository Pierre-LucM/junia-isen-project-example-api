name: "CI - API  Lint and run Test"

on:
  workflow_call:
    inputs:
      python_version:
        description: "Python version to use"
        required: true
        default: "3"
        type: string

jobs:
  lint-test:
    runs-on: ubuntu-latest
    steps:
      # Checkout code
      # Purpose: Checkout the code from the repository. The code is checked out to the $GITHUB_WORKSPACE directory.
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Create env file
        run: |
            echo "COSMOS_ENDPOINT=${{ secrets.COSMOS_ENDPOINT }}" >> $PWD/.env
            echo "COSMOS_KEY=${{ secrets.COSMOS_KEY }}" >> $PWD/.env
          
      # Run linter (flake8)
      # Purpose: Run the flake8 linter on the project. The linter checks for PEP8 compliance.
      - name: Run linter (flake8)
        run: uv run flake8 --max-line-length=120 $GITHUB_WORKSPACE/api


        # Run API tests
        # Purpose: Run the API tests using pytest. The tests are located in the api/tests directory.
      - name: Run API tests
        run: uv run pytest $GITHUB_WORKSPACE/api/tests
      